version: '3.8'
services:
  # 1. Database Service (MySQL)
  db:
    image: mysql:8.0
    container_name: filmshoot-db
    # ... other config (ports, environment, volumes) ...
    # You already have this part set up

  # 2. Backend Service (Uses the ./backend/Dockerfile)
  backend:
    build: 
      context: ./backend 
    ports:
      - "4000:4000"
    environment:
      # Crucial: Uses the service name 'mysql-db' for internal networking
      DATABASE_URL: mysql://my_user:my-secret-password@mysql-db:3306/my_prisma_db
    depends_on:
      - mysql-db
    volumes:
      - ./backend:/app

  # 3. Frontend Service (Uses the ./frontend/Dockerfile)
  frontend:
    build: 
      context: ./frontend 
    # Maps host port 3000 to container port 80 (NGINX)
    ports:
      - "3000:80" 
    depends_on:
      - backend